(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{126:function(e,t){},128:function(e,t){},152:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(59),o=n.n(r),c=(n(69),n(10)),s=n(12),u=n(11),d=n(27),l=n(9),f=n(6),m=n(26);n(70),n(71);function h(e){var t=e.isExpanded,n=e.onClick;return i.a.createElement("button",{className:"ExpandButton",onClick:n},function(e){return e?"\u25b6\u25c0":"\u25c0\u25b6"}(t))}function p(e){var t=e.isTruncated,n=e.location;return t?n.address.city+", "+n.address.state:n.display_name}n(72);function g(){return i.a.createElement("div",{className:"SectionDivider"})}n(73);var v=n(21),M={},y=M;function E(){window.innerWidth>window.innerHeight?(M.major=window.innerWidth,M.minor=window.innerHeight):(M.major=window.innerHeight,M.minor=window.innerWidth)}E(),window.addEventListener("resize",E),window.addEventListener("orientationchange",E);var b=n(60),w=n.n(b),C=n(61),R=n.n(C),x=n(62),N=n.n(x),S=w.a,T=R.a,j=N.a;function P(e){return e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()}function O(e){return["January","February","March","April","May","June","July","August","September","October","November","December"][e]}function k(e){return e.getHours()+":"+e.getMinutes()}function L(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),a=Math.floor(e%60);return B(t,2)+":"+B(n,2)+":"+B(a,2)}function B(e,t){var n=""+e;return n.length<t?"0".repeat(t-n.length)+n:n}function H(e,t){return new Promise(function(n,a){S().reverse(t,e).end(function(e,t){e?a(e):(console.log(t),n(t))})})}function _(e,t,n){var a=e.getTime(),i=t.getTime();return new Date(a+(i-a)*n)}function F(e,t){for(var n=t.getTime(),a=e.length,i=0;i<a;i++){if(e[i].timestamp.getTime()>=n)return i}return a-1}function U(e){return e.reduce(function(e,t){return e+t},0)}function A(e){var t=e.sport.sport,n=e.activity,a=n.sessions.map(I),i=a.map(function(e){return e.laps}).flat(),r=a.map(function(e){return e.records}).flat();r.forEach(function(e,t){e.index=t});var o=U(a.map(function(e){return e.total_distance})),s=U(a.map(function(e){return e.total_elapsed_time})),u=r[0].timestamp,d=r[r.length-1].timestamp,l=Object(c.a)({},n,{sport:t,sessions:a,laps:i,records:r,total_distance:o,total_elapsed_time:s,start_time:u,end_time:d});return function(e){"running"===e.sport&&e.records.forEach(function(e){e.cadence*=2})}(l),function(e){e.records.forEach(function(e){e.pace=60/(e.speed*V)})}(l),l}function I(e){var t=Object(c.a)({},e);return t.laps=t.laps.map(D),t.records=t.laps.map(function(e){return e.records}).flat(),t.start_time=t.records[0].timestamp,t.end_time=t.records[t.records.length-1].timestamp,t}function D(e){var t=Object(c.a)({},e);return t.records=t.records.slice(),t.start_time=t.records[0].timestamp,t.end_time=t.records[t.records.length-1].timestamp,t}var W,V=.621371;!function(e){e[e.HeartRate=0]="HeartRate",e[e.Cadence=1]="Cadence",e[e.Pace=2]="Pace"}(W||(W={}));var J,z=(J=W,Object.values(J).filter(function(e){return"number"===typeof e}));function X(e,t){switch(t){case W.HeartRate:return e.heart_rate;case W.Cadence:return e.cadence;case W.Pace:return e.pace}}function $(e){var t=e.attribute,n=e.records,a=e.offsetIndex,r=e.width,o=e.filter,c=e.shouldConvertRpmToSpm;return i.a.createElement("div",{className:"Timeline"},i.a.createElement("div",{className:"TimelineLabel"},function(e,t){switch(e){case W.HeartRate:return"Heart rate (bpm)";case W.Cadence:return"Cadence "+(t?"(spm)":"(rpm)");case W.Pace:return"Pace (min/mi)"}}(t,c),function(){var e=n[a];return e?i.a.createElement("span",{className:"ActiveRecordValue ActiveRecordValue--"+(o.isAttributeIllegal(t,e)?"illegal":o.isAnyAttributeIllegal(e)?"illegalOther":"legal")}," = "+(t===W.Pace?function(e){if(isNaN(e)||e===1/0||e===-1/0)return"stationary";var t=e-Math.floor(e);return Math.floor(e)+":"+B(Math.floor(60*t),2)}(X(e,t)):X(e,t))):null}()),i.a.createElement(v.Stage,{width:window.innerWidth,height:Q()},i.a.createElement(v.Layer,{width:window.innerWidth,height:Q()},i.a.createElement(v.Rect,{fill:"#eeea",width:window.innerWidth,height:Q()}),n.slice(a,a+r).map(function(e,n){return i.a.createElement(v.Circle,{key:e.index,fill:o.isAttributeIllegal(t,e)?G:o.isAnyAttributeIllegal(e)?K:0===n?Y:q,x:window.innerWidth*(n/r)+Z(),y:Q()-Q()*(X(e,t)/200),radius:Z()})}))))}var Y="#3ce",q="#08b",G="red",K="orange";function Q(){return.2*y.minor}function Z(){return.005*y.major}var ee,te=n(63);!function(e){e[e.Min=0]="Min",e[e.Max=1]="Max"}(ee||(ee={}));var ne=function(){function e(t){Object(s.a)(this,e),this.pendingHeartRateMin=void 0,this.pendingHeartRateMax=void 0,this.pendingCadenceMin=void 0,this.pendingCadenceMax=void 0,this.pendingSpeedMin=void 0,this.pendingSpeedMax=void 0,this.heartRate=void 0,this.cadence=void 0,this.speed=void 0,this.pendingHeartRateMin=""+t.heartRate[0],this.pendingHeartRateMax=""+t.heartRate[1],this.pendingCadenceMin=""+t.cadence[0],this.pendingCadenceMax=""+t.cadence[1],this.pendingSpeedMin=""+t.speed[0],this.pendingSpeedMax=""+t.speed[1],this.heartRate=t.heartRate,this.cadence=t.cadence,this.speed=t.speed}return Object(u.a)(e,[{key:"setPendingBound",value:function(t,n,a){var i=new e(this.config());return i[function(e,t){var n=function(e){switch(e){case W.HeartRate:return"pendingHeartRate";case W.Cadence:return"pendingCadence";case W.Pace:return"pendingSpeed"}}(e),a=function(e){switch(e){case ee.Min:return"Min";case ee.Max:return"Max"}}(t);return n+a}(t,n)]=a,i}},{key:"config",value:function(){return{heartRate:this.heartRate,cadence:this.cadence,speed:this.speed}}},{key:"syncPendingBoundsWithActualBounds",value:function(){return new e({heartRate:ae(this.heartRate,this.pendingHeartRateMin,this.pendingHeartRateMax),cadence:ae(this.cadence,this.pendingCadenceMin,this.pendingCadenceMax),speed:ae(this.speed,this.pendingSpeedMin,this.pendingSpeedMax)})}},{key:"isAttributeIllegal",value:function(e,t){return!this.isAttributeLegal(e,t)}},{key:"isAttributeLegal",value:function(e,t){var n=this.getBounds(e),a=Object(te.a)(n,2),i=a[0],r=a[1],o=X(t,e);return i<=o&&o<=r}},{key:"isAnyAttributeIllegal",value:function(e){var t=this;return z.some(function(n){return t.isAttributeIllegal(n,e)})}},{key:"getBounds",value:function(e){switch(e){case W.HeartRate:return this.heartRate;case W.Cadence:return this.cadence;case W.Pace:return this.speed}}}]),e}();function ae(e,t,n){var a=ie(t),i=ie(n);return[isNaN(a)?e[0]:a,isNaN(i)?e[1]:i]}function ie(e){return/^-?\d*$/.test(e)?parseInt(e,10):NaN}var re,oe=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"match",value:function(e){return this.isNone()?e.none():e.some(this.value)}},{key:"isNone",value:function(){return this.isNone_}},{key:"isSome",value:function(){return!this.isNone()}},{key:"map",value:function(t){var n=this;return this.match({none:function(){return n},some:function(n){return e.some(t(n))}})}},{key:"unwrapOr",value:function(e){return this.match({none:function(){return e},some:function(e){return e}})}}],[{key:"some",value:function(t){var n=Object.create(e.prototype);return n.isNone_=!1,n.value=t,n}},{key:"none",value:function(){return ce}}]),e}(),ce=function(){var e=Object.create(oe.prototype);return e.isNone_=!0,e}(),se=n(32),ue=n(64);!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(re||(re={}));var de=function(e){function t(e,n){var a;return Object(s.a)(this,t),(a=Object(d.a)(this,Object(l.a)(t).call(this,e))).status=void 0,a.value=void 0,a.error=void 0,a.updateListeners=void 0,a.status=re.Pending,a.updateListeners=[],n&&(Object(se.a)(Object(l.a)(t.prototype),"then",Object(f.a)(a)).call(Object(f.a)(a),function(e){a.status=re.Fulfilled,a.value=e,a.updateListeners.forEach(function(e){e()})}),Object(se.a)(Object(l.a)(t.prototype),"catch",Object(f.a)(a)).call(Object(f.a)(a),function(e){a.status=re.Rejected,a.error=e,a.updateListeners.forEach(function(e){e()})})),a}return Object(m.a)(t,e),Object(u.a)(t,null,[{key:"fromPromise",value:function(e){return new t(function(t,n){e.then(t),e.catch(n)},!0)}}]),Object(u.a)(t,[{key:"match",value:function(e){switch("function"===typeof e.onUpdate&&this.updateListeners.push(e.onUpdate),this.status){case re.Pending:return e.pending();case re.Fulfilled:return e.fulfilled(this.value);case re.Rejected:return e.rejected(this.error)}}}]),t}(Object(ue.a)(Promise)),le=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).fileRef=void 0,n.minimapRef=void 0,n.onChangePendingHeartRateMin=void 0,n.onChangePendingHeartRateMax=void 0,n.onChangePendingCadenceMin=void 0,n.onChangePendingCadenceMax=void 0,n.onChangePendingSpeedMin=void 0,n.onChangePendingSpeedMax=void 0,n.state={activity:oe.none(),mouseDownTarget:oe.none(),filter:new ne({heartRate:[0,200],cadence:[0,125],speed:[0,40]})},n.fileRef=i.a.createRef(),n.minimapRef=i.a.createRef(),window.addEventListener("resize",function(){return n.forceUpdate()}),window.addEventListener("orientationchange",function(){return n.forceUpdate()}),n.forceUpdate=n.forceUpdate.bind(Object(f.a)(n)),n.handleUpload=n.handleUpload.bind(Object(f.a)(n)),n.toggleIsStartLocationTruncated=n.toggleIsStartLocationTruncated.bind(Object(f.a)(n)),n.toggleIsEndLocationTruncated=n.toggleIsEndLocationTruncated.bind(Object(f.a)(n)),n.onMouseDown=n.onMouseDown.bind(Object(f.a)(n)),n.onMouseUp=n.onMouseUp.bind(Object(f.a)(n)),n.onMouseMove=n.onMouseMove.bind(Object(f.a)(n)),n.onTouchStart=n.onTouchStart.bind(Object(f.a)(n)),n.onTouchMove=n.onTouchMove.bind(Object(f.a)(n)),n.onTouchEnd=n.onTouchEnd.bind(Object(f.a)(n)),n.onSyncPendingBounds=n.onSyncPendingBounds.bind(Object(f.a)(n)),n.onChangePendingHeartRateMin=function(e){return n.onChangePendingBound(W.HeartRate,ee.Min,e)},n.onChangePendingHeartRateMax=function(e){return n.onChangePendingBound(W.HeartRate,ee.Max,e)},n.onChangePendingCadenceMin=function(e){return n.onChangePendingBound(W.Cadence,ee.Min,e)},n.onChangePendingCadenceMax=function(e){return n.onChangePendingBound(W.Cadence,ee.Max,e)},n.onChangePendingSpeedMin=function(e){return n.onChangePendingBound(W.Pace,ee.Min,e)},n.onChangePendingSpeedMax=function(e){return n.onChangePendingBound(W.Pace,ee.Max,e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"App",onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onTouchStart:this.onTouchStart,onTouchMove:this.onTouchMove,onTouchEnd:this.onTouchEnd},this.state.activity.match({none:function(){return i.a.createElement("label",{className:"UploadButton"},i.a.createElement("input",{type:"file",accept:"fit",onChange:e.handleUpload,ref:e.fileRef,style:{display:"none"}}),"Upload .fit file")},some:function(t){var n=t.activity,a=t.startLocation,r=t.isStartLocationTruncated,o=t.endLocation,c=t.isEndLocationTruncated,s=t.offsetTime,u=t.offsetIndex,d=t.width,l=n.sport,f=n.records,m=n.total_elapsed_time,v=n.start_time,M=n.end_time,y="running"===l;return i.a.createElement("div",{className:"ActivityView"},i.a.createElement("div",{className:"Head"},i.a.createElement("div",{className:"Header"},O(v.getMonth())+" "+v.getDate()+" ",a.match({onUpdate:e.forceUpdate,pending:function(){return""},fulfilled:function(e){return e.address.city+" "},rejected:function(){return""}}),P(l)),i.a.createElement("div",{className:"MinimapBackground",ref:e.minimapRef},i.a.createElement("div",{className:"MinimapForeground",style:{width:100*(s.getTime()-v.getTime())/(M.getTime()-v.getTime())+"%"}}))),i.a.createElement("div",{className:"Body"},i.a.createElement("div",{className:"ActivityOverview"},i.a.createElement("div",{className:"Entry"},"Sport:"," ",i.a.createElement("span",{className:"Value"},P(l))),i.a.createElement("div",{className:"Entry"},"Date:"," ",i.a.createElement("span",{className:"Value"},["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][v.getDay()]," ",v.getDate()," ",O(v.getMonth())," ",v.getFullYear())),i.a.createElement("div",{className:"Entry"},"Start location:"," ",i.a.createElement("span",{className:"Value"},a.match({pending:function(){return"loading"},fulfilled:function(t){return i.a.createElement(i.a.Fragment,null,i.a.createElement(h,{isExpanded:!r,onClick:e.toggleIsStartLocationTruncated}),i.a.createElement(p,{isTruncated:r,location:t}))},rejected:function(e){return console.log("Error loading start location",e),"Error loading location"},onUpdate:e.forceUpdate}))),i.a.createElement("div",{className:"Entry"},"End location:"," ",i.a.createElement("span",{className:"Value"},o.match({pending:function(){return"loading"},fulfilled:function(t){return i.a.createElement(i.a.Fragment,null,i.a.createElement(h,{isExpanded:!c,onClick:e.toggleIsEndLocationTruncated}),i.a.createElement(p,{isTruncated:c,location:t}))},rejected:function(e){return console.log("Error loading start location",e),"Error loading location"},onUpdate:e.forceUpdate}))),i.a.createElement("div",{className:"Entry"},"Total duration:"," ",i.a.createElement("span",{className:"Value"},L(m))," ","Start time:"," ",i.a.createElement("span",{className:"Value"},k(v))," End time: ",i.a.createElement("span",{className:"Value"},k(M)))),i.a.createElement(g,null),i.a.createElement("div",{className:"TimelineContainer"},i.a.createElement($,{attribute:W.HeartRate,records:f,offsetIndex:u,width:d,filter:e.state.filter,shouldConvertRpmToSpm:y}),i.a.createElement($,{attribute:W.Cadence,records:f,offsetIndex:u,width:d,filter:e.state.filter,shouldConvertRpmToSpm:y}),i.a.createElement($,{attribute:W.Pace,records:f,offsetIndex:u,width:d,filter:e.state.filter,shouldConvertRpmToSpm:y})),i.a.createElement(g,null),i.a.createElement("div",{className:"FilterContainer"},i.a.createElement("div",{className:"Filter"},i.a.createElement("div",{className:"FilterAttribute"},"Heart Rate"),i.a.createElement("label",{className:"FilterMinLabel"},"Min:"," ",i.a.createElement("input",{className:"FilterMin",type:"text",pattern:"\\d*",value:e.state.filter.pendingHeartRateMin,onChange:e.onChangePendingHeartRateMin,onBlur:e.onSyncPendingBounds})),i.a.createElement("label",{className:"FilterMaxLabel"},"Max:"," ",i.a.createElement("input",{className:"FilterMax",type:"text",pattern:"\\d*",value:e.state.filter.pendingHeartRateMax,onChange:e.onChangePendingHeartRateMax,onBlur:e.onSyncPendingBounds}))),i.a.createElement("div",{className:"Filter"},i.a.createElement("div",{className:"FilterAttribute"},"Cadence"),i.a.createElement("label",{className:"FilterMinLabel"},"Min:"," ",i.a.createElement("input",{className:"FilterMin",type:"text",pattern:"\\d*",value:e.state.filter.pendingCadenceMin,onChange:e.onChangePendingCadenceMin,onBlur:e.onSyncPendingBounds})),i.a.createElement("label",{className:"FilterMaxLabel"},"Max:"," ",i.a.createElement("input",{className:"FilterMax",type:"text",pattern:"\\d*",value:e.state.filter.pendingCadenceMax,onChange:e.onChangePendingCadenceMax,onBlur:e.onSyncPendingBounds}))),i.a.createElement("div",{className:"Filter"},i.a.createElement("div",{className:"FilterAttribute"},"Speed"),i.a.createElement("label",{className:"FilterMinLabel"},"Min:"," ",i.a.createElement("input",{className:"FilterMin",type:"text",pattern:"\\d*",value:e.state.filter.pendingSpeedMin,onChange:e.onChangePendingSpeedMin,onBlur:e.onSyncPendingBounds})),i.a.createElement("label",{className:"FilterMaxLabel"},"Max:"," ",i.a.createElement("input",{className:"FilterMax",type:"text",pattern:"\\d*",value:e.state.filter.pendingSpeedMax,onChange:e.onChangePendingSpeedMax,onBlur:e.onSyncPendingBounds}))))))}}))}},{key:"handleUpload",value:function(){var e=this,t=this.fileRef.current.files;if(null!==t&&"object"===typeof t&&t.length>0){var n=t[0],a=new FileReader;a.addEventListener("loadend",function(){if(a.error)throw a.error;var t=a.result;new j({force:!0,speedUnit:"km/h",lengthUnit:"m",temperatureUnit:"kelvin",elapsedRecordField:!0,mode:"cascade"}).parse(t,function(t,n){if(t)throw t;var a=n.activity.sessions[0],i=function(e){return e.sessions.map(function(e){return function(e){return e.laps.map(function(e){return e.records}).flat()}(e)}).flat()}(n.activity),r=i[i.length-1],o=A(n);e.setState({activity:oe.some({activity:o,startLocation:de.fromPromise(H(a.start_position_lat,a.start_position_long)),isStartLocationTruncated:!0,endLocation:de.fromPromise(H(r.position_lat,r.position_long)),isEndLocationTruncated:!0,offsetTime:o.start_time,offsetIndex:0,width:fe})})})}),a.readAsArrayBuffer(n)}}},{key:"toggleIsStartLocationTruncated",value:function(){this.setState(function(e){return{activity:e.activity.map(function(e){return Object(c.a)({},e,{isStartLocationTruncated:!e.isStartLocationTruncated})})}})}},{key:"toggleIsEndLocationTruncated",value:function(){this.setState(function(e){return{activity:e.activity.map(function(e){return Object(c.a)({},e,{isEndLocationTruncated:!e.isEndLocationTruncated})})}})}},{key:"onMouseDown",value:function(e){this.setState({mouseDownTarget:oe.some(e.target)})}},{key:"onMouseUp",value:function(){this.setState(function(e){return Object(c.a)({},e,{mouseDownTarget:oe.none()})})}},{key:"onMouseMove",value:function(e){if(this.isCursorDragged()&&this.minimapRef&&this.minimapRef.current){var t=this.minimapRef.current.getBoundingClientRect(),n=(e.clientX-t.left)/t.width,a=Math.min(1,Math.max(0,n));this.setState(function(e){return{activity:e.activity.map(function(e){var t=_(e.activity.start_time,e.activity.end_time,a);return Object(c.a)({},e,{offsetTime:t,offsetIndex:F(e.activity.records,t)})})}})}}},{key:"isCursorDragged",value:function(){var e=this.minimapRef;return this.state.mouseDownTarget.match({none:function(){return!1},some:function(t){return!!(e&&e.current&&T(e.current,t))}})}},{key:"onTouchStart",value:function(e){this.onMouseDown(e)}},{key:"onTouchMove",value:function(e){if(this.isCursorDragged()&&this.minimapRef&&this.minimapRef.current){var t=this.minimapRef.current.getBoundingClientRect(),n=(e.touches[0].clientX-t.left)/t.width,a=Math.min(1,Math.max(0,n));this.setState(function(e){return{activity:e.activity.map(function(e){var t=_(e.activity.start_time,e.activity.end_time,a);return Object(c.a)({},e,{offsetTime:t,offsetIndex:F(e.activity.records,t)})})}})}}},{key:"onTouchEnd",value:function(){this.onMouseUp()}},{key:"onChangePendingBound",value:function(e,t,n){this.setState({filter:this.state.filter.setPendingBound(e,t,n.target.value)})}},{key:"onSyncPendingBounds",value:function(){this.setState({filter:this.state.filter.syncPendingBoundsWithActualBounds()})}}]),t}(i.a.Component),fe=87;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(le,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},65:function(e,t,n){e.exports=n(152)},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){},72:function(e,t,n){},73:function(e,t,n){}},[[65,1,2]]]);
//# sourceMappingURL=main.5db995ac.chunk.js.map